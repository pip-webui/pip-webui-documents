!function(e){"use strict";e.module("pipDocuments",["pipDocumentList","pipDocumentListEdit"])}(window.angular),function(e){try{e=angular.module("pipDocuments.Templates")}catch(n){e=angular.module("pipDocuments.Templates",[])}e.run(["$templateCache",function(e){e.put("document_list/document_list.html",'<md-button class="pip-documents-name" ng-class="{\'lp24-flex rp16\': pipDocumentIcon}" ng-click="onTitleClick($event); onResize()" aria-label="RESIZE"><div class="layout-align-start-center layout-row w-stretch"><md-icon md-svg-icon="icons:document" ng-class="{\'pip-icon\': pipDocumentIcon}" ng-if="pipDocumentIcon"></md-icon><span class="pip-documents-text">{{documents.length}} {{::\'DOCUMENTS_ATTACHED\' | translate}}</span><md-icon class="icon-up" md-svg-icon="icons:triangle-up"></md-icon><md-icon class="icon-down" md-svg-icon="icons:triangle-down"></md-icon></div></md-button><div pip-focused="" class="pip-documents-container bm8" ng-class="{\'lp24-flex rp24-flex\': pipDocumentIcon}"><md-button class="pip-document-download md-primary" ng-class="{\'pip-focusable\' : !ngDisabled()}" href="{{::documentUrl(document)}}" target="_blank" ng-disabled="ngDisabled() || document.error" ng-repeat="document in documents track by document.file_id" aria-label="DOCUMENT"><div class="pip-default-icon"><md-icon md-svg-icon="icons:{{::documentList.icon}}"></md-icon></div><div class="pip-document-title">{{::document.file_name}}</div></md-button></div>')}])}(),function(e){try{e=angular.module("pipDocuments.Templates")}catch(n){e=angular.module("pipDocuments.Templates",[])}e.run(["$templateCache",function(e){e.put("document_list/document_list_collapse.html",'<div class="pip-documents-name" ng-click="onTitleClick($event); onResize()"><span class="pip-documents-text">{{documents.length}} {{::\'DOCUMENTS_ATTACHED\' | translate}}</span><md-icon class="icon-up" md-svg-icon="icons:triangle-up"></md-icon><md-icon class="icon-down" md-svg-icon="icons:triangle-down"></md-icon></div><div pip-focused="" class="pip-documents-container bm8"><md-button class="pip-document-download pip-focusable md-primary" href="{{::document.url}}" target="_blank" ng-repeat="document in documents track by document.file_id" aria-label="DOCUMENT"><div class="pip-default-icon"><md-icon md-svg-icon="icons:{{::icon}}"></md-icon></div><div class="pip-document-title">{{::document.file_name}}</div></md-button></div>')}])}(),function(e){try{e=angular.module("pipDocuments.Templates")}catch(n){e=angular.module("pipDocuments.Templates",[])}e.run(["$templateCache",function(e){e.put("document_list_edit/document_list_edit.html",'<div pip-focusable=""><div class="pip-document-upload pointer md-primary" ng-class="{\'pip-focusable\' : !ngDisabled(), \'pip-item-error\' : item.state == \'error\'}" ng-keydown="onKeyDown($event, item)" tabindex="{{ ngDisabled() ? -1 : 0 }}" ng-repeat="item in control.items | filter: filterItem"><div class="pip-default-icon" ng-class="{ \'pip-document-new\': item.id == null }"><md-icon pip-cancel-drag="true" class="md-primary" ng-if="item.state == \'original\' || item.state == \'added\'" md-svg-icon="icons:{{::documentList.icon}}"></md-icon><md-icon pip-cancel-drag="true" class="md-warn" ng-if="item.state == \'error\'" md-svg-icon="icons:{{::documentList.iconError}}"></md-icon></div><div class="pip-document-title" pip-cancel-drag="true">{{::item.name}}</div><md-button ng-click="onDelete(item)" ng-disabled="ngDisabled() || control.uploading" tabindex="-1" ng-hide="ngDisabled()" class="md-icon-button" aria-label="DELETE"><md-icon md-svg-icon="icons:cross" pip-cancel-drag="true"></md-icon></md-button><md-progress-linear ng-show="item.uploading" ng-value="item.progress"></md-progress-linear></div><button class="pip-document-upload pip-document-drop" ng-class="{\'pip-focusable\' : !ngDisabled()}" ng-keydown="onKeyDown($event)" tabindex="0" ng-file-drop="" ng-file-select="" ng-file-change="onSelect($files)" ng-multiple="true" ng-disabled="ngDisabled() || control.uploading" aria-label="UPLOAD"><div class="pip-default-icon"><md-icon pip-cancel-drag="true" md-svg-icon="icons:{{::documentList.icon}}"></md-icon></div><div class="pip-default-text"><span>{{documentList.text | translate}}</span></div></button><div class="clearfix"></div></div>')}])}(),function(e,n){"use strict";var t=e.module("pipDocumentListEdit",["ui.event","pipCore","pipFocused","pipDataDocument","pipDocuments.Templates"]);t.config(["pipTranslateProvider",function(e){e.translations("en",{DOCUMENT_LIST_EDIT_TEXT:"Click here to add a document",ERROR_TRANSACTION_IN_PROGRESS:"Transaction is in progress. Please, wait until it's finished or abort"}),e.translations("ru",{DOCUMENT_LIST_EDIT_TEXT:"Нажмите сюда, чтобы добавить документ",ERROR_TRANSACTION_IN_PROGRESS:"Транзакция еще не завершена. Подождите окончания или прервите её"})}]),t.directive("pipDocumentListEdit",function(){return{restrict:"EA",scope:{pipDocuments:"=",pipAddedDocument:"=",ngDisabled:"&",pipCreated:"&",pipChanged:"&"},templateUrl:"document_list_edit/document_list_edit.html",controller:"pipDocumentListEditController"}}),t.controller("pipDocumentListEditController",["$scope","$rootScope","$element","$attrs","$parse","$timeout","pipDataDocument","pipUtils",function(e,t,o,i,c,d,l,a){function s(){var n,t=e.pipDocuments,o=[];if(null===t||0===t.length)return o;for(n=0;n<t.length;n++)o.push({pin:E++,id:t[n].file_id,name:t[n].file_name,uploading:!1,uploaded:!1,progress:0,file:null,state:e.documentStartState});return o}function p(){var n,t;for(e.pipDocuments&&e.pipDocuments.length>0&&e.pipDocuments.splice(0,e.pipDocuments.length),t=0;t<e.control.items.length;t++)n=e.control.items[t],n.id&&e.pipDocuments.push({file_id:n.id,file_name:n.name})}function u(){e.control.uploading=0,e.control.items=s()}function r(e,n){var t=e.file,o=new FileReader;e.uploading||null===e.file||"added"!==e.state||(o.onload=function(o){e.uploading||(e.uploading=!0,e.upload=l.createDocument({name:e.file.name,type:t.type,data:o.target.result},function(t){e.id=t.data.id,e.name=t.data.filename||e.name,e.uploaded=!0,e.uploading=!1,e.progress=0,e.upload=null,e.file=null,e.state="original",n()},function(){e.uploaded=!1,e.uploading=!1,e.progress=0,e.upload=null,e.state="error",n()},function(n){e.progress=Math.min(100,parseInt(100*n.loaded/n.total))}))},o.readAsArrayBuffer(t))}function m(t,o){var i=e.control;t.upload&&(t.upload.abort(),t.upload=null),"deleted"===t.state&&l.deleteDocument(t.id,function(){n.remove(i.items,{pin:t.pin}),o()},function(e){null==e?n.remove(i.items,{pin:t.pin}):(t.uploaded=!1,t.uploading=!1,t.progress=0,t.upload=null),o(e)})}function g(n,t){var o,i,c,d=e.control;if(d.uploading)return void(t&&t("ERROR_TRANSACTION_IN_PROGRESS"));for(d.error=null,d.uploading=0,o=function(e){e&&!d.error&&(d.error=e),d.uploading--,0==d.uploading&&(d.error?t?t(d.error):console.error(d.error):(p(),n&&n()))},c=0;c<d.items.length;c++)i=d.items[c],"added"===i.state?(d.uploading++,r(i,o)):"deleted"===i.state&&(d.uploading++,m(i,o));0==d.uploading&&n&&n()}function f(){var n,t,o=e.control;for(t=0;t<o.items.length;t++)n=o.items[t],n.uploading&&(n.upload&&n.upload.abort(),n.uploaded=!1,n.uploading=!1,n.progress=0,n.upload=null);o.uploading=0}function D(e){return"deleted"!==e.state}function v(n){var t,o;if(C.focus(),null!=n&&0!==n.length){for(o=0;o<n.length;o++)t=n[o],e.control.items.push({pin:E++,id:null,name:t.name,uploading:!1,uploaded:!1,progress:0,file:t,state:"added"});e.onChange()}}function h(t){"added"===t.state||"copied"===t.state?n.remove(e.control.items,{pin:t.pin}):t.state="deleted",e.onChange()}function _(t,o){o?46!==t.keyCode&&8!==t.keyCode||("added"===o.state?n.remove(e.control.items,{pin:o.pin}):o.state="deleted",e.onChange()):13!==t.keyCode&&32!==t.keyCode||setTimeout(function(){C.trigger("click")},0)}function T(){e.pipChanged&&e.pipChanged({$event:{sender:e.control},$control:e.control})}function b(){e.pipCreated&&e.pipCreated({$event:{sender:e.control},$control:e.control})}var C=o.children(".pip-picture-drop"),E=0;e.documentList={},e.documentList.text=i.pipDefaultText||"DOCUMENT_LIST_EDIT_TEXT",e.documentList.icon=i.pipDefaultIcon||"document",e.documentList.iconError="warn-circle",e.documentStartState=a.toBoolean(e.pipAddedDocument)?"copied":"original",e.cancelDrag=a.toBoolean(i.pipCanselDrag)===!0,e.control={uploading:0,items:s(),reset:u,save:g,abort:f},e.filterItem=D,e.onDelete=h,e.onKeyDown=_,e.onChange=T,e.onSelect=v,o.addClass("pip-document-list-edit"),e.control.reset(),b(),e.$watchCollection(function(){return e.pipDocuments},function(t){n.isEqual(t,e.pipDocuments)||e.control.reset()})}])}(window.angular,window._),function(e,n){"use strict";var t=e.module("pipDocumentList",["pipCore","pipDataDocument","pipFocused","pipDocuments.Templates"]);t.config(["pipTranslateProvider",function(e){e.translations("en",{DOCUMENTS_ATTACHED:"document(s) attached",ERROR_DOCUMENTS_LOADED:"Error: <%= error_number %> document(s) are not loaded"}),e.translations("ru",{DOCUMENTS_ATTACHED:"документов добавлено",ERROR_DOCUMENTS_LOADED:"Ошибка: <%= error_number %> документ(ов) не загружено"})}]),t.directive("pipDocumentList",["$parse","$rootScope","pipUtils","pipDataDocument","pipToasts","pipTranslate",function(e,t,o,i,c,d){return{restrict:"EA",scope:!0,templateUrl:"document_list/document_list.html",link:function(t,c,d){function l(e){var o,i;if(!t.documents&&e)return!0;if(t.documents&&!e)return!0;if(t.documents.length!==e.length)return!0;for(o=0;o<e.length;o++)if(i=n.find(t.documents,{file_id:e[o].file_id}),void 0===i)return!0;return!1}function a(e){e&&e.stopPropagation(),d.disabled||(t.showDocuments=!t.showDocuments,r[t.showDocuments?"show":"hide"](),m[t.showDocuments?"hide":"show"](),u[t.showDocuments?"show":"hide"]())}function s(e){return i.getDocumentContentUrl(e.file_id)}var p=e(d.pipDocuments),u=c.children(".pip-documents-container"),r=c.find(".icon-up"),m=c.find(".icon-down"),g=o.toBoolean(d.pipCollapse);t.documentList={},t.documentList.icon="document",t.documents=p(t),d.pipDocumentIcon&&(t.pipDocumentIcon=!0),t.showDocuments=g,g?m.hide():(r.hide(),u.hide()),d.disabled&&(r.hide(),m.hide()),o.toBoolean(d.pipRebind)&&t.$watch(p,function(e){l(e)&&(t.documents=e)}),t.onTitleClick=a,t.documentUrl=s,c.addClass("pip-document-list")}}}])}(window.angular,window._);